/*! For license information please see mopidy-queue-card.js.LICENSE.txt */
import{LitElement as t,css as e,html as o}from"lit";import{customElement as n,property as i,state as r}from"lit/decorators.js";var a={};function l(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,n)}return o}function s(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?l(Object(o),!0).forEach(function(e){d(t,e,o[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):l(Object(o)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))})}return t}function c(t){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c(t)}function d(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function u(){return u=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n])}return t},u.apply(this,arguments)}function h(t){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(t)}a.d=(t,e)=>{for(var o in e)a.o(e,o)&&!a.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var p=h(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),f=h(/Edge/i),g=h(/firefox/i),v=h(/safari/i)&&!h(/chrome/i)&&!h(/android/i),m=h(/iP(ad|od|hone)/i),b=h(/chrome/i)&&h(/android/i),y={capture:!1,passive:!1};function w(t,e,o){t.addEventListener(e,o,!p&&y)}function _(t,e,o){t.removeEventListener(e,o,!p&&y)}function E(t,e){if(e){if(">"===e[0]&&(e=e.substring(1)),t)try{if(t.matches)return t.matches(e);if(t.msMatchesSelector)return t.msMatchesSelector(e);if(t.webkitMatchesSelector)return t.webkitMatchesSelector(e)}catch(t){return!1}return!1}}function S(t){return t.host&&t!==document&&t.host.nodeType?t.host:t.parentNode}function D(t,e,o,n){if(t){o=o||document;do{if(null!=e&&(">"===e[0]?t.parentNode===o&&E(t,e):E(t,e))||n&&t===o)return t;if(t===o)break}while(t=S(t))}return null}var x,T=/\s+/g;function k(t,e,o){if(t&&e)if(t.classList)t.classList[o?"add":"remove"](e);else{var n=(" "+t.className+" ").replace(T," ").replace(" "+e+" "," ");t.className=(n+(o?" "+e:"")).replace(T," ")}}function C(t,e,o){var n=t&&t.style;if(n){if(void 0===o)return document.defaultView&&document.defaultView.getComputedStyle?o=document.defaultView.getComputedStyle(t,""):t.currentStyle&&(o=t.currentStyle),void 0===e?o:o[e];e in n||-1!==e.indexOf("webkit")||(e="-webkit-"+e),n[e]=o+("string"==typeof o?"":"px")}}function O(t,e){var o="";if("string"==typeof t)o=t;else do{var n=C(t,"transform");n&&"none"!==n&&(o=n+" "+o)}while(!e&&(t=t.parentNode));var i=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return i&&new i(o)}function P(t,e,o){if(t){var n=t.getElementsByTagName(e),i=0,r=n.length;if(o)for(;i<r;i++)o(n[i],i);return n}return[]}function M(){return document.scrollingElement||document.documentElement}function I(t,e,o,n,i){if(t.getBoundingClientRect||t===window){var r,a,l,s,c,d,u;if(t!==window&&t.parentNode&&t!==M()?(a=(r=t.getBoundingClientRect()).top,l=r.left,s=r.bottom,c=r.right,d=r.height,u=r.width):(a=0,l=0,s=window.innerHeight,c=window.innerWidth,d=window.innerHeight,u=window.innerWidth),(e||o)&&t!==window&&(i=i||t.parentNode,!p))do{if(i&&i.getBoundingClientRect&&("none"!==C(i,"transform")||o&&"static"!==C(i,"position"))){var h=i.getBoundingClientRect();a-=h.top+parseInt(C(i,"border-top-width")),l-=h.left+parseInt(C(i,"border-left-width")),s=a+r.height,c=l+r.width;break}}while(i=i.parentNode);if(n&&t!==window){var f=O(i||t),g=f&&f.a,v=f&&f.d;f&&(s=(a/=v)+(d/=v),c=(l/=g)+(u/=g))}return{top:a,left:l,bottom:s,right:c,width:u,height:d}}}function A(t,e,o){for(var n=q(t,!0),i=I(t)[e];n;){var r=I(n)[o];if(!("top"===o||"left"===o?i>=r:i<=r))return n;if(n===M())break;n=q(n,!1)}return!1}function N(t,e,o,n){for(var i=0,r=0,a=t.children;r<a.length;){if("none"!==a[r].style.display&&a[r]!==Bt.ghost&&(n||a[r]!==Bt.dragged)&&D(a[r],o.draggable,t,!1)){if(i===e)return a[r];i++}r++}return null}function R(t,e){for(var o=t.lastElementChild;o&&(o===Bt.ghost||"none"===C(o,"display")||e&&!E(o,e));)o=o.previousElementSibling;return o||null}function X(t,e){var o=0;if(!t||!t.parentNode)return-1;for(;t=t.previousElementSibling;)"TEMPLATE"===t.nodeName.toUpperCase()||t===Bt.clone||e&&!E(t,e)||o++;return o}function Y(t){var e=0,o=0,n=M();if(t)do{var i=O(t),r=i.a,a=i.d;e+=t.scrollLeft*r,o+=t.scrollTop*a}while(t!==n&&(t=t.parentNode));return[e,o]}function q(t,e){if(!t||!t.getBoundingClientRect)return M();var o=t,n=!1;do{if(o.clientWidth<o.scrollWidth||o.clientHeight<o.scrollHeight){var i=C(o);if(o.clientWidth<o.scrollWidth&&("auto"==i.overflowX||"scroll"==i.overflowX)||o.clientHeight<o.scrollHeight&&("auto"==i.overflowY||"scroll"==i.overflowY)){if(!o.getBoundingClientRect||o===document.body)return M();if(n||e)return o;n=!0}}}while(o=o.parentNode);return M()}function F(t,e){return Math.round(t.top)===Math.round(e.top)&&Math.round(t.left)===Math.round(e.left)&&Math.round(t.height)===Math.round(e.height)&&Math.round(t.width)===Math.round(e.width)}function j(t,e){return function(){if(!x){var o=arguments;1===o.length?t.call(this,o[0]):t.apply(this,o),x=setTimeout(function(){x=void 0},e)}}}function B(t,e,o){t.scrollLeft+=e,t.scrollTop+=o}function L(t){var e=window.Polymer,o=window.jQuery||window.Zepto;return e&&e.dom?e.dom(t).cloneNode(!0):o?o(t).clone(!0)[0]:t.cloneNode(!0)}function $(t,e,o){var n={};return Array.from(t.children).forEach(function(i){var r,a,l,s;if(D(i,e.draggable,t,!1)&&!i.animated&&i!==o){var c=I(i);n.left=Math.min(null!==(r=n.left)&&void 0!==r?r:1/0,c.left),n.top=Math.min(null!==(a=n.top)&&void 0!==a?a:1/0,c.top),n.right=Math.max(null!==(l=n.right)&&void 0!==l?l:-1/0,c.right),n.bottom=Math.max(null!==(s=n.bottom)&&void 0!==s?s:-1/0,c.bottom)}}),n.width=n.right-n.left,n.height=n.bottom-n.top,n.x=n.left,n.y=n.top,n}var z="Sortable"+(new Date).getTime();var H=[],W={initializeByDefault:!0},U={mount:function(t){for(var e in W)W.hasOwnProperty(e)&&!(e in t)&&(t[e]=W[e]);H.forEach(function(e){if(e.pluginName===t.pluginName)throw"Sortable: Cannot mount plugin ".concat(t.pluginName," more than once")}),H.push(t)},pluginEvent:function(t,e,o){var n=this;this.eventCanceled=!1,o.cancel=function(){n.eventCanceled=!0};var i=t+"Global";H.forEach(function(n){e[n.pluginName]&&(e[n.pluginName][i]&&e[n.pluginName][i](s({sortable:e},o)),e.options[n.pluginName]&&e[n.pluginName][t]&&e[n.pluginName][t](s({sortable:e},o)))})},initializePlugins:function(t,e,o,n){for(var i in H.forEach(function(n){var i=n.pluginName;if(t.options[i]||n.initializeByDefault){var r=new n(t,e,t.options);r.sortable=t,r.options=t.options,t[i]=r,u(o,r.defaults)}}),t.options)if(t.options.hasOwnProperty(i)){var r=this.modifyOption(t,i,t.options[i]);void 0!==r&&(t.options[i]=r)}},getEventProperties:function(t,e){var o={};return H.forEach(function(n){"function"==typeof n.eventProperties&&u(o,n.eventProperties.call(e[n.pluginName],t))}),o},modifyOption:function(t,e,o){var n;return H.forEach(function(i){t[i.pluginName]&&i.optionListeners&&"function"==typeof i.optionListeners[e]&&(n=i.optionListeners[e].call(t[i.pluginName],o))}),n}};var G=["evt"],V=function(t,e){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=o.evt,i=function(t,e){if(null==t)return{};var o,n,i=function(t,e){if(null==t)return{};var o,n,i={},r=Object.keys(t);for(n=0;n<r.length;n++)o=r[n],e.indexOf(o)>=0||(i[o]=t[o]);return i}(t,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(n=0;n<r.length;n++)o=r[n],e.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(t,o)&&(i[o]=t[o])}return i}(o,G);U.pluginEvent.bind(Bt)(t,e,s({dragEl:Z,parentEl:K,ghostEl:J,rootEl:tt,nextEl:et,lastDownEl:ot,cloneEl:nt,cloneHidden:it,dragStarted:mt,putSortable:dt,activeSortable:Bt.active,originalEvent:n,oldIndex:rt,oldDraggableIndex:lt,newIndex:at,newDraggableIndex:st,hideGhostForTarget:Yt,unhideGhostForTarget:qt,cloneNowHidden:function(){it=!0},cloneNowShown:function(){it=!1},dispatchSortableEvent:function(t){Q({sortable:e,name:t,originalEvent:n})}},i))};function Q(t){!function(t){var e=t.sortable,o=t.rootEl,n=t.name,i=t.targetEl,r=t.cloneEl,a=t.toEl,l=t.fromEl,c=t.oldIndex,d=t.newIndex,u=t.oldDraggableIndex,h=t.newDraggableIndex,g=t.originalEvent,v=t.putSortable,m=t.extraEventProperties;if(e=e||o&&o[z]){var b,y=e.options,w="on"+n.charAt(0).toUpperCase()+n.substr(1);!window.CustomEvent||p||f?(b=document.createEvent("Event")).initEvent(n,!0,!0):b=new CustomEvent(n,{bubbles:!0,cancelable:!0}),b.to=a||o,b.from=l||o,b.item=i||o,b.clone=r,b.oldIndex=c,b.newIndex=d,b.oldDraggableIndex=u,b.newDraggableIndex=h,b.originalEvent=g,b.pullMode=v?v.lastPutMode:void 0;var _=s(s({},m),U.getEventProperties(n,e));for(var E in _)b[E]=_[E];o&&o.dispatchEvent(b),y[w]&&y[w].call(e,b)}}(s({putSortable:dt,cloneEl:nt,targetEl:Z,rootEl:tt,oldIndex:rt,oldDraggableIndex:lt,newIndex:at,newDraggableIndex:st},t))}var Z,K,J,tt,et,ot,nt,it,rt,at,lt,st,ct,dt,ut,ht,pt,ft,gt,vt,mt,bt,yt,wt,_t,Et=!1,St=!1,Dt=[],xt=!1,Tt=!1,kt=[],Ct=!1,Ot=[],Pt="undefined"!=typeof document,Mt=m,It=f||p?"cssFloat":"float",At=Pt&&!b&&!m&&"draggable"in document.createElement("div"),Nt=function(){if(Pt){if(p)return!1;var t=document.createElement("x");return t.style.cssText="pointer-events:auto","auto"===t.style.pointerEvents}}(),Rt=function(t,e){var o=C(t),n=parseInt(o.width)-parseInt(o.paddingLeft)-parseInt(o.paddingRight)-parseInt(o.borderLeftWidth)-parseInt(o.borderRightWidth),i=N(t,0,e),r=N(t,1,e),a=i&&C(i),l=r&&C(r),s=a&&parseInt(a.marginLeft)+parseInt(a.marginRight)+I(i).width,c=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+I(r).width;if("flex"===o.display)return"column"===o.flexDirection||"column-reverse"===o.flexDirection?"vertical":"horizontal";if("grid"===o.display)return o.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(i&&a.float&&"none"!==a.float){var d="left"===a.float?"left":"right";return!r||"both"!==l.clear&&l.clear!==d?"horizontal":"vertical"}return i&&("block"===a.display||"flex"===a.display||"table"===a.display||"grid"===a.display||s>=n&&"none"===o[It]||r&&"none"===o[It]&&s+c>n)?"vertical":"horizontal"},Xt=function(t){function e(t,o){return function(n,i,r,a){var l=n.options.group.name&&i.options.group.name&&n.options.group.name===i.options.group.name;if(null==t&&(o||l))return!0;if(null==t||!1===t)return!1;if(o&&"clone"===t)return t;if("function"==typeof t)return e(t(n,i,r,a),o)(n,i,r,a);var s=(o?n:i).options.group.name;return!0===t||"string"==typeof t&&t===s||t.join&&t.indexOf(s)>-1}}var o={},n=t.group;n&&"object"==c(n)||(n={name:n}),o.name=n.name,o.checkPull=e(n.pull,!0),o.checkPut=e(n.put),o.revertClone=n.revertClone,t.group=o},Yt=function(){!Nt&&J&&C(J,"display","none")},qt=function(){!Nt&&J&&C(J,"display","")};Pt&&!b&&document.addEventListener("click",function(t){if(St)return t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation(),St=!1,!1},!0);var Ft=function(t){if(Z){t=t.touches?t.touches[0]:t;var e=(i=t.clientX,r=t.clientY,Dt.some(function(t){var e=t[z].options.emptyInsertThreshold;if(e&&!R(t)){var o=I(t),n=i>=o.left-e&&i<=o.right+e,l=r>=o.top-e&&r<=o.bottom+e;return n&&l?a=t:void 0}}),a);if(e){var o={};for(var n in t)t.hasOwnProperty(n)&&(o[n]=t[n]);o.target=o.rootEl=e,o.preventDefault=void 0,o.stopPropagation=void 0,e[z]._onDragOver(o)}}var i,r,a},jt=function(t){Z&&Z.parentNode[z]._isOutsideThisEl(t.target)};function Bt(t,e){if(!t||!t.nodeType||1!==t.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(t));this.el=t,this.options=e=u({},e),t[z]=this;var o,n,i={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(t.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Rt(t,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(t,e){t.setData("Text",e.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==Bt.supportPointer&&"PointerEvent"in window&&(!v||m),emptyInsertThreshold:5};for(var r in U.initializePlugins(this,t,i),i)!(r in e)&&(e[r]=i[r]);for(var a in Xt(e),this)"_"===a.charAt(0)&&"function"==typeof this[a]&&(this[a]=this[a].bind(this));this.nativeDraggable=!e.forceFallback&&At,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?w(t,"pointerdown",this._onTapStart):(w(t,"mousedown",this._onTapStart),w(t,"touchstart",this._onTapStart)),this.nativeDraggable&&(w(t,"dragover",this),w(t,"dragenter",this)),Dt.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),u(this,(n=[],{captureAnimationState:function(){n=[],this.options.animation&&[].slice.call(this.el.children).forEach(function(t){if("none"!==C(t,"display")&&t!==Bt.ghost){n.push({target:t,rect:I(t)});var e=s({},n[n.length-1].rect);if(t.thisAnimationDuration){var o=O(t,!0);o&&(e.top-=o.f,e.left-=o.e)}t.fromRect=e}})},addAnimationState:function(t){n.push(t)},removeAnimationState:function(t){n.splice(function(t,e){for(var o in t)if(t.hasOwnProperty(o))for(var n in e)if(e.hasOwnProperty(n)&&e[n]===t[o][n])return Number(o);return-1}(n,{target:t}),1)},animateAll:function(t){var e=this;if(!this.options.animation)return clearTimeout(o),void("function"==typeof t&&t());var i=!1,r=0;n.forEach(function(t){var o=0,n=t.target,a=n.fromRect,l=I(n),s=n.prevFromRect,c=n.prevToRect,d=t.rect,u=O(n,!0);u&&(l.top-=u.f,l.left-=u.e),n.toRect=l,n.thisAnimationDuration&&F(s,l)&&!F(a,l)&&(d.top-l.top)/(d.left-l.left)===(a.top-l.top)/(a.left-l.left)&&(o=function(t,e,o,n){return Math.sqrt(Math.pow(e.top-t.top,2)+Math.pow(e.left-t.left,2))/Math.sqrt(Math.pow(e.top-o.top,2)+Math.pow(e.left-o.left,2))*n.animation}(d,s,c,e.options)),F(l,a)||(n.prevFromRect=a,n.prevToRect=l,o||(o=e.options.animation),e.animate(n,d,l,o)),o&&(i=!0,r=Math.max(r,o),clearTimeout(n.animationResetTimer),n.animationResetTimer=setTimeout(function(){n.animationTime=0,n.prevFromRect=null,n.fromRect=null,n.prevToRect=null,n.thisAnimationDuration=null},o),n.thisAnimationDuration=o)}),clearTimeout(o),i?o=setTimeout(function(){"function"==typeof t&&t()},r):"function"==typeof t&&t(),n=[]},animate:function(t,e,o,n){if(n){C(t,"transition",""),C(t,"transform","");var i=O(this.el),r=i&&i.a,a=i&&i.d,l=(e.left-o.left)/(r||1),s=(e.top-o.top)/(a||1);t.animatingX=!!l,t.animatingY=!!s,C(t,"transform","translate3d("+l+"px,"+s+"px,0)"),this.forRepaintDummy=function(t){return t.offsetWidth}(t),C(t,"transition","transform "+n+"ms"+(this.options.easing?" "+this.options.easing:"")),C(t,"transform","translate3d(0,0,0)"),"number"==typeof t.animated&&clearTimeout(t.animated),t.animated=setTimeout(function(){C(t,"transition",""),C(t,"transform",""),t.animated=!1,t.animatingX=!1,t.animatingY=!1},n)}}}))}function Lt(t,e,o,n,i,r,a,l){var s,c,d=t[z],u=d.options.onMove;return!window.CustomEvent||p||f?(s=document.createEvent("Event")).initEvent("move",!0,!0):s=new CustomEvent("move",{bubbles:!0,cancelable:!0}),s.to=e,s.from=t,s.dragged=o,s.draggedRect=n,s.related=i||e,s.relatedRect=r||I(e),s.willInsertAfter=l,s.originalEvent=a,t.dispatchEvent(s),u&&(c=u.call(d,s,a)),c}function $t(t){t.draggable=!1}function zt(){Ct=!1}function Ht(t){for(var e=t.tagName+t.className+t.src+t.href+t.textContent,o=e.length,n=0;o--;)n+=e.charCodeAt(o);return n.toString(36)}function Wt(t){return setTimeout(t,0)}function Ut(t){return clearTimeout(t)}Bt.prototype={constructor:Bt,_isOutsideThisEl:function(t){this.el.contains(t)||t===this.el||(bt=null)},_getDirection:function(t,e){return"function"==typeof this.options.direction?this.options.direction.call(this,t,e,Z):this.options.direction},_onTapStart:function(t){if(t.cancelable){var e=this,o=this.el,n=this.options,i=n.preventOnFilter,r=t.type,a=t.touches&&t.touches[0]||t.pointerType&&"touch"===t.pointerType&&t,l=(a||t).target,s=t.target.shadowRoot&&(t.path&&t.path[0]||t.composedPath&&t.composedPath()[0])||l,c=n.filter;if(function(t){Ot.length=0;for(var e=t.getElementsByTagName("input"),o=e.length;o--;){var n=e[o];n.checked&&Ot.push(n)}}(o),!Z&&!(/mousedown|pointerdown/.test(r)&&0!==t.button||n.disabled)&&!s.isContentEditable&&(this.nativeDraggable||!v||!l||"SELECT"!==l.tagName.toUpperCase())&&!((l=D(l,n.draggable,o,!1))&&l.animated||ot===l)){if(rt=X(l),lt=X(l,n.draggable),"function"==typeof c){if(c.call(this,t,l,this))return Q({sortable:e,rootEl:s,name:"filter",targetEl:l,toEl:o,fromEl:o}),V("filter",e,{evt:t}),void(i&&t.preventDefault())}else if(c&&(c=c.split(",").some(function(n){if(n=D(s,n.trim(),o,!1))return Q({sortable:e,rootEl:n,name:"filter",targetEl:l,fromEl:o,toEl:o}),V("filter",e,{evt:t}),!0})))return void(i&&t.preventDefault());n.handle&&!D(s,n.handle,o,!1)||this._prepareDragStart(t,a,l)}}},_prepareDragStart:function(t,e,o){var n,i=this,r=i.el,a=i.options,l=r.ownerDocument;if(o&&!Z&&o.parentNode===r){var s=I(o);if(tt=r,K=(Z=o).parentNode,et=Z.nextSibling,ot=o,ct=a.group,Bt.dragged=Z,ut={target:Z,clientX:(e||t).clientX,clientY:(e||t).clientY},gt=ut.clientX-s.left,vt=ut.clientY-s.top,this._lastX=(e||t).clientX,this._lastY=(e||t).clientY,Z.style["will-change"]="all",n=function(){V("delayEnded",i,{evt:t}),Bt.eventCanceled?i._onDrop():(i._disableDelayedDragEvents(),!g&&i.nativeDraggable&&(Z.draggable=!0),i._triggerDragStart(t,e),Q({sortable:i,name:"choose",originalEvent:t}),k(Z,a.chosenClass,!0))},a.ignore.split(",").forEach(function(t){P(Z,t.trim(),$t)}),w(l,"dragover",Ft),w(l,"mousemove",Ft),w(l,"touchmove",Ft),a.supportPointer?(w(l,"pointerup",i._onDrop),!this.nativeDraggable&&w(l,"pointercancel",i._onDrop)):(w(l,"mouseup",i._onDrop),w(l,"touchend",i._onDrop),w(l,"touchcancel",i._onDrop)),g&&this.nativeDraggable&&(this.options.touchStartThreshold=4,Z.draggable=!0),V("delayStart",this,{evt:t}),!a.delay||a.delayOnTouchOnly&&!e||this.nativeDraggable&&(f||p))n();else{if(Bt.eventCanceled)return void this._onDrop();a.supportPointer?(w(l,"pointerup",i._disableDelayedDrag),w(l,"pointercancel",i._disableDelayedDrag)):(w(l,"mouseup",i._disableDelayedDrag),w(l,"touchend",i._disableDelayedDrag),w(l,"touchcancel",i._disableDelayedDrag)),w(l,"mousemove",i._delayedDragTouchMoveHandler),w(l,"touchmove",i._delayedDragTouchMoveHandler),a.supportPointer&&w(l,"pointermove",i._delayedDragTouchMoveHandler),i._dragStartTimer=setTimeout(n,a.delay)}}},_delayedDragTouchMoveHandler:function(t){var e=t.touches?t.touches[0]:t;Math.max(Math.abs(e.clientX-this._lastX),Math.abs(e.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){Z&&$t(Z),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var t=this.el.ownerDocument;_(t,"mouseup",this._disableDelayedDrag),_(t,"touchend",this._disableDelayedDrag),_(t,"touchcancel",this._disableDelayedDrag),_(t,"pointerup",this._disableDelayedDrag),_(t,"pointercancel",this._disableDelayedDrag),_(t,"mousemove",this._delayedDragTouchMoveHandler),_(t,"touchmove",this._delayedDragTouchMoveHandler),_(t,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(t,e){e=e||"touch"==t.pointerType&&t,!this.nativeDraggable||e?this.options.supportPointer?w(document,"pointermove",this._onTouchMove):w(document,e?"touchmove":"mousemove",this._onTouchMove):(w(Z,"dragend",this),w(tt,"dragstart",this._onDragStart));try{document.selection?Wt(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch(t){}},_dragStarted:function(t,e){if(Et=!1,tt&&Z){V("dragStarted",this,{evt:e}),this.nativeDraggable&&w(document,"dragover",jt);var o=this.options;!t&&k(Z,o.dragClass,!1),k(Z,o.ghostClass,!0),Bt.active=this,t&&this._appendGhost(),Q({sortable:this,name:"start",originalEvent:e})}else this._nulling()},_emulateDragOver:function(){if(ht){this._lastX=ht.clientX,this._lastY=ht.clientY,Yt();for(var t=document.elementFromPoint(ht.clientX,ht.clientY),e=t;t&&t.shadowRoot&&(t=t.shadowRoot.elementFromPoint(ht.clientX,ht.clientY))!==e;)e=t;if(Z.parentNode[z]._isOutsideThisEl(t),e)do{if(e[z]&&e[z]._onDragOver({clientX:ht.clientX,clientY:ht.clientY,target:t,rootEl:e})&&!this.options.dragoverBubble)break;t=e}while(e=S(e));qt()}},_onTouchMove:function(t){if(ut){var e=this.options,o=e.fallbackTolerance,n=e.fallbackOffset,i=t.touches?t.touches[0]:t,r=J&&O(J,!0),a=J&&r&&r.a,l=J&&r&&r.d,s=Mt&&_t&&Y(_t),c=(i.clientX-ut.clientX+n.x)/(a||1)+(s?s[0]-kt[0]:0)/(a||1),d=(i.clientY-ut.clientY+n.y)/(l||1)+(s?s[1]-kt[1]:0)/(l||1);if(!Bt.active&&!Et){if(o&&Math.max(Math.abs(i.clientX-this._lastX),Math.abs(i.clientY-this._lastY))<o)return;this._onDragStart(t,!0)}if(J){r?(r.e+=c-(pt||0),r.f+=d-(ft||0)):r={a:1,b:0,c:0,d:1,e:c,f:d};var u="matrix(".concat(r.a,",").concat(r.b,",").concat(r.c,",").concat(r.d,",").concat(r.e,",").concat(r.f,")");C(J,"webkitTransform",u),C(J,"mozTransform",u),C(J,"msTransform",u),C(J,"transform",u),pt=c,ft=d,ht=i}t.cancelable&&t.preventDefault()}},_appendGhost:function(){if(!J){var t=this.options.fallbackOnBody?document.body:tt,e=I(Z,!0,Mt,!0,t),o=this.options;if(Mt){for(_t=t;"static"===C(_t,"position")&&"none"===C(_t,"transform")&&_t!==document;)_t=_t.parentNode;_t!==document.body&&_t!==document.documentElement?(_t===document&&(_t=M()),e.top+=_t.scrollTop,e.left+=_t.scrollLeft):_t=M(),kt=Y(_t)}k(J=Z.cloneNode(!0),o.ghostClass,!1),k(J,o.fallbackClass,!0),k(J,o.dragClass,!0),C(J,"transition",""),C(J,"transform",""),C(J,"box-sizing","border-box"),C(J,"margin",0),C(J,"top",e.top),C(J,"left",e.left),C(J,"width",e.width),C(J,"height",e.height),C(J,"opacity","0.8"),C(J,"position",Mt?"absolute":"fixed"),C(J,"zIndex","100000"),C(J,"pointerEvents","none"),Bt.ghost=J,t.appendChild(J),C(J,"transform-origin",gt/parseInt(J.style.width)*100+"% "+vt/parseInt(J.style.height)*100+"%")}},_onDragStart:function(t,e){var o=this,n=t.dataTransfer,i=o.options;V("dragStart",this,{evt:t}),Bt.eventCanceled?this._onDrop():(V("setupClone",this),Bt.eventCanceled||((nt=L(Z)).removeAttribute("id"),nt.draggable=!1,nt.style["will-change"]="",this._hideClone(),k(nt,this.options.chosenClass,!1),Bt.clone=nt),o.cloneId=Wt(function(){V("clone",o),Bt.eventCanceled||(o.options.removeCloneOnHide||tt.insertBefore(nt,Z),o._hideClone(),Q({sortable:o,name:"clone"}))}),!e&&k(Z,i.dragClass,!0),e?(St=!0,o._loopId=setInterval(o._emulateDragOver,50)):(_(document,"mouseup",o._onDrop),_(document,"touchend",o._onDrop),_(document,"touchcancel",o._onDrop),n&&(n.effectAllowed="move",i.setData&&i.setData.call(o,n,Z)),w(document,"drop",o),C(Z,"transform","translateZ(0)")),Et=!0,o._dragStartId=Wt(o._dragStarted.bind(o,e,t)),w(document,"selectstart",o),mt=!0,window.getSelection().removeAllRanges(),v&&C(document.body,"user-select","none"))},_onDragOver:function(t){var e,o,n,i,r=this.el,a=t.target,l=this.options,c=l.group,d=Bt.active,u=ct===c,h=l.sort,p=dt||d,f=this,g=!1;if(!Ct){if(void 0!==t.preventDefault&&t.cancelable&&t.preventDefault(),a=D(a,l.draggable,r,!0),q("dragOver"),Bt.eventCanceled)return g;if(Z.contains(t.target)||a.animated&&a.animatingX&&a.animatingY||f._ignoreWhileAnimating===a)return j(!1);if(St=!1,d&&!l.disabled&&(u?h||(n=K!==tt):dt===this||(this.lastPutMode=ct.checkPull(this,d,Z,t))&&c.checkPut(this,d,Z,t))){if(i="vertical"===this._getDirection(t,a),e=I(Z),q("dragOverValid"),Bt.eventCanceled)return g;if(n)return K=tt,F(),this._hideClone(),q("revert"),Bt.eventCanceled||(et?tt.insertBefore(Z,et):tt.appendChild(Z)),j(!0);var v=R(r,l.draggable);if(!v||function(t,e,o){var n=I(R(o.el,o.options.draggable)),i=$(o.el,o.options,J);return e?t.clientX>i.right+10||t.clientY>n.bottom&&t.clientX>n.left:t.clientY>i.bottom+10||t.clientX>n.right&&t.clientY>n.top}(t,i,this)&&!v.animated){if(v===Z)return j(!1);if(v&&r===t.target&&(a=v),a&&(o=I(a)),!1!==Lt(tt,r,Z,e,a,o,t,!!a))return F(),v&&v.nextSibling?r.insertBefore(Z,v.nextSibling):r.appendChild(Z),K=r,L(),j(!0)}else if(v&&function(t,e,o){var n=I(N(o.el,0,o.options,!0)),i=$(o.el,o.options,J);return e?t.clientX<i.left-10||t.clientY<n.top&&t.clientX<n.right:t.clientY<i.top-10||t.clientY<n.bottom&&t.clientX<n.left}(t,i,this)){var m=N(r,0,l,!0);if(m===Z)return j(!1);if(o=I(a=m),!1!==Lt(tt,r,Z,e,a,o,t,!1))return F(),r.insertBefore(Z,m),K=r,L(),j(!0)}else if(a.parentNode===r){o=I(a);var b,y,w,_=Z.parentNode!==r,E=!function(t,e,o){var n=o?t.left:t.top,i=o?t.right:t.bottom,r=o?t.width:t.height,a=o?e.left:e.top,l=o?e.right:e.bottom,s=o?e.width:e.height;return n===a||i===l||n+r/2===a+s/2}(Z.animated&&Z.toRect||e,a.animated&&a.toRect||o,i),S=i?"top":"left",x=A(a,"top","top")||A(Z,"top","top"),T=x?x.scrollTop:void 0;if(bt!==a&&(y=o[S],xt=!1,Tt=!E&&l.invertSwap||_),b=function(t,e,o,n,i,r,a,l){var s=n?t.clientY:t.clientX,c=n?o.height:o.width,d=n?o.top:o.left,u=n?o.bottom:o.right,h=!1;if(!a)if(l&&wt<c*i){if(!xt&&(1===yt?s>d+c*r/2:s<u-c*r/2)&&(xt=!0),xt)h=!0;else if(1===yt?s<d+wt:s>u-wt)return-yt}else if(s>d+c*(1-i)/2&&s<u-c*(1-i)/2)return function(t){return X(Z)<X(t)?1:-1}(e);return(h=h||a)&&(s<d+c*r/2||s>u-c*r/2)?s>d+c/2?1:-1:0}(t,a,o,i,E?1:l.swapThreshold,null==l.invertedSwapThreshold?l.swapThreshold:l.invertedSwapThreshold,Tt,bt===a),0!==b){var O=X(Z);do{O-=b,w=K.children[O]}while(w&&("none"===C(w,"display")||w===J))}if(0===b||w===a)return j(!1);bt=a,yt=b;var P=a.nextElementSibling,M=!1,Y=Lt(tt,r,Z,e,a,o,t,M=1===b);if(!1!==Y)return 1!==Y&&-1!==Y||(M=1===Y),Ct=!0,setTimeout(zt,30),F(),M&&!P?r.appendChild(Z):a.parentNode.insertBefore(Z,M?P:a),x&&B(x,0,T-x.scrollTop),K=Z.parentNode,void 0===y||Tt||(wt=Math.abs(y-I(a)[S])),L(),j(!0)}if(r.contains(Z))return j(!1)}return!1}function q(l,c){V(l,f,s({evt:t,isOwner:u,axis:i?"vertical":"horizontal",revert:n,dragRect:e,targetRect:o,canSort:h,fromSortable:p,target:a,completed:j,onMove:function(o,n){return Lt(tt,r,Z,e,o,I(o),t,n)},changed:L},c))}function F(){q("dragOverAnimationCapture"),f.captureAnimationState(),f!==p&&p.captureAnimationState()}function j(e){return q("dragOverCompleted",{insertion:e}),e&&(u?d._hideClone():d._showClone(f),f!==p&&(k(Z,dt?dt.options.ghostClass:d.options.ghostClass,!1),k(Z,l.ghostClass,!0)),dt!==f&&f!==Bt.active?dt=f:f===Bt.active&&dt&&(dt=null),p===f&&(f._ignoreWhileAnimating=a),f.animateAll(function(){q("dragOverAnimationComplete"),f._ignoreWhileAnimating=null}),f!==p&&(p.animateAll(),p._ignoreWhileAnimating=null)),(a===Z&&!Z.animated||a===r&&!a.animated)&&(bt=null),l.dragoverBubble||t.rootEl||a===document||(Z.parentNode[z]._isOutsideThisEl(t.target),!e&&Ft(t)),!l.dragoverBubble&&t.stopPropagation&&t.stopPropagation(),g=!0}function L(){at=X(Z),st=X(Z,l.draggable),Q({sortable:f,name:"change",toEl:r,newIndex:at,newDraggableIndex:st,originalEvent:t})}},_ignoreWhileAnimating:null,_offMoveEvents:function(){_(document,"mousemove",this._onTouchMove),_(document,"touchmove",this._onTouchMove),_(document,"pointermove",this._onTouchMove),_(document,"dragover",Ft),_(document,"mousemove",Ft),_(document,"touchmove",Ft)},_offUpEvents:function(){var t=this.el.ownerDocument;_(t,"mouseup",this._onDrop),_(t,"touchend",this._onDrop),_(t,"pointerup",this._onDrop),_(t,"pointercancel",this._onDrop),_(t,"touchcancel",this._onDrop),_(document,"selectstart",this)},_onDrop:function(t){var e=this.el,o=this.options;at=X(Z),st=X(Z,o.draggable),V("drop",this,{evt:t}),K=Z&&Z.parentNode,at=X(Z),st=X(Z,o.draggable),Bt.eventCanceled||(Et=!1,Tt=!1,xt=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Ut(this.cloneId),Ut(this._dragStartId),this.nativeDraggable&&(_(document,"drop",this),_(e,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),v&&C(document.body,"user-select",""),C(Z,"transform",""),t&&(mt&&(t.cancelable&&t.preventDefault(),!o.dropBubble&&t.stopPropagation()),J&&J.parentNode&&J.parentNode.removeChild(J),(tt===K||dt&&"clone"!==dt.lastPutMode)&&nt&&nt.parentNode&&nt.parentNode.removeChild(nt),Z&&(this.nativeDraggable&&_(Z,"dragend",this),$t(Z),Z.style["will-change"]="",mt&&!Et&&k(Z,dt?dt.options.ghostClass:this.options.ghostClass,!1),k(Z,this.options.chosenClass,!1),Q({sortable:this,name:"unchoose",toEl:K,newIndex:null,newDraggableIndex:null,originalEvent:t}),tt!==K?(at>=0&&(Q({rootEl:K,name:"add",toEl:K,fromEl:tt,originalEvent:t}),Q({sortable:this,name:"remove",toEl:K,originalEvent:t}),Q({rootEl:K,name:"sort",toEl:K,fromEl:tt,originalEvent:t}),Q({sortable:this,name:"sort",toEl:K,originalEvent:t})),dt&&dt.save()):at!==rt&&at>=0&&(Q({sortable:this,name:"update",toEl:K,originalEvent:t}),Q({sortable:this,name:"sort",toEl:K,originalEvent:t})),Bt.active&&(null!=at&&-1!==at||(at=rt,st=lt),Q({sortable:this,name:"end",toEl:K,originalEvent:t}),this.save())))),this._nulling()},_nulling:function(){V("nulling",this),tt=Z=K=J=et=nt=ot=it=ut=ht=mt=at=st=rt=lt=bt=yt=dt=ct=Bt.dragged=Bt.ghost=Bt.clone=Bt.active=null,Ot.forEach(function(t){t.checked=!0}),Ot.length=pt=ft=0},handleEvent:function(t){switch(t.type){case"drop":case"dragend":this._onDrop(t);break;case"dragenter":case"dragover":Z&&(this._onDragOver(t),function(t){t.dataTransfer&&(t.dataTransfer.dropEffect="move"),t.cancelable&&t.preventDefault()}(t));break;case"selectstart":t.preventDefault()}},toArray:function(){for(var t,e=[],o=this.el.children,n=0,i=o.length,r=this.options;n<i;n++)D(t=o[n],r.draggable,this.el,!1)&&e.push(t.getAttribute(r.dataIdAttr)||Ht(t));return e},sort:function(t,e){var o={},n=this.el;this.toArray().forEach(function(t,e){var i=n.children[e];D(i,this.options.draggable,n,!1)&&(o[t]=i)},this),e&&this.captureAnimationState(),t.forEach(function(t){o[t]&&(n.removeChild(o[t]),n.appendChild(o[t]))}),e&&this.animateAll()},save:function(){var t=this.options.store;t&&t.set&&t.set(this)},closest:function(t,e){return D(t,e||this.options.draggable,this.el,!1)},option:function(t,e){var o=this.options;if(void 0===e)return o[t];var n=U.modifyOption(this,t,e);o[t]=void 0!==n?n:e,"group"===t&&Xt(o)},destroy:function(){V("destroy",this);var t=this.el;t[z]=null,_(t,"mousedown",this._onTapStart),_(t,"touchstart",this._onTapStart),_(t,"pointerdown",this._onTapStart),this.nativeDraggable&&(_(t,"dragover",this),_(t,"dragenter",this)),Array.prototype.forEach.call(t.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),Dt.splice(Dt.indexOf(this.el),1),this.el=t=null},_hideClone:function(){if(!it){if(V("hideClone",this),Bt.eventCanceled)return;C(nt,"display","none"),this.options.removeCloneOnHide&&nt.parentNode&&nt.parentNode.removeChild(nt),it=!0}},_showClone:function(t){if("clone"===t.lastPutMode){if(it){if(V("showClone",this),Bt.eventCanceled)return;Z.parentNode!=tt||this.options.group.revertClone?et?tt.insertBefore(nt,et):tt.appendChild(nt):tt.insertBefore(nt,Z),this.options.group.revertClone&&this.animate(Z,nt),C(nt,"display",""),it=!1}}else this._hideClone()}},Pt&&w(document,"touchmove",function(t){(Bt.active||Et)&&t.cancelable&&t.preventDefault()}),Bt.utils={on:w,off:_,css:C,find:P,is:function(t,e){return!!D(t,e,t,!1)},extend:function(t,e){if(t&&e)for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);return t},throttle:j,closest:D,toggleClass:k,clone:L,index:X,nextTick:Wt,cancelNextTick:Ut,detectDirection:Rt,getChild:N,expando:z},Bt.get=function(t){return t[z]},Bt.mount=function(){for(var t=arguments.length,e=new Array(t),o=0;o<t;o++)e[o]=arguments[o];e[0].constructor===Array&&(e=e[0]),e.forEach(function(t){if(!t.prototype||!t.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(t));t.utils&&(Bt.utils=s(s({},Bt.utils),t.utils)),U.mount(t)})},Bt.create=function(t,e){return new Bt(t,e)},Bt.version="1.15.6";var Gt,Vt,Qt,Zt,Kt,Jt,te=[],ee=!1;function oe(){te.forEach(function(t){clearInterval(t.pid)}),te=[]}function ne(){clearInterval(Jt)}var ie=j(function(t,e,o,n){if(e.scroll){var i,r=(t.touches?t.touches[0]:t).clientX,a=(t.touches?t.touches[0]:t).clientY,l=e.scrollSensitivity,s=e.scrollSpeed,c=M(),d=!1;Vt!==o&&(Vt=o,oe(),Gt=e.scroll,i=e.scrollFn,!0===Gt&&(Gt=q(o,!0)));var u=0,h=Gt;do{var p=h,f=I(p),g=f.top,v=f.bottom,m=f.left,b=f.right,y=f.width,w=f.height,_=void 0,E=void 0,S=p.scrollWidth,D=p.scrollHeight,x=C(p),T=p.scrollLeft,k=p.scrollTop;p===c?(_=y<S&&("auto"===x.overflowX||"scroll"===x.overflowX||"visible"===x.overflowX),E=w<D&&("auto"===x.overflowY||"scroll"===x.overflowY||"visible"===x.overflowY)):(_=y<S&&("auto"===x.overflowX||"scroll"===x.overflowX),E=w<D&&("auto"===x.overflowY||"scroll"===x.overflowY));var O=_&&(Math.abs(b-r)<=l&&T+y<S)-(Math.abs(m-r)<=l&&!!T),P=E&&(Math.abs(v-a)<=l&&k+w<D)-(Math.abs(g-a)<=l&&!!k);if(!te[u])for(var A=0;A<=u;A++)te[A]||(te[A]={});te[u].vx==O&&te[u].vy==P&&te[u].el===p||(te[u].el=p,te[u].vx=O,te[u].vy=P,clearInterval(te[u].pid),0==O&&0==P||(d=!0,te[u].pid=setInterval(function(){n&&0===this.layer&&Bt.active._onTouchMove(Kt);var e=te[this.layer].vy?te[this.layer].vy*s:0,o=te[this.layer].vx?te[this.layer].vx*s:0;"function"==typeof i&&"continue"!==i.call(Bt.dragged.parentNode[z],o,e,t,Kt,te[this.layer].el)||B(te[this.layer].el,o,e)}.bind({layer:u}),24))),u++}while(e.bubbleScroll&&h!==c&&(h=q(h,!1)));ee=d}},30),re=function(t){var e=t.originalEvent,o=t.putSortable,n=t.dragEl,i=t.activeSortable,r=t.dispatchSortableEvent,a=t.hideGhostForTarget,l=t.unhideGhostForTarget;if(e){var s=o||i;a();var c=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e,d=document.elementFromPoint(c.clientX,c.clientY);l(),s&&!s.el.contains(d)&&(r("spill"),this.onSpill({dragEl:n,putSortable:o}))}};function ae(){}function le(){}ae.prototype={startIndex:null,dragStart:function(t){var e=t.oldDraggableIndex;this.startIndex=e},onSpill:function(t){var e=t.dragEl,o=t.putSortable;this.sortable.captureAnimationState(),o&&o.captureAnimationState();var n=N(this.sortable.el,this.startIndex,this.options);n?this.sortable.el.insertBefore(e,n):this.sortable.el.appendChild(e),this.sortable.animateAll(),o&&o.animateAll()},drop:re},u(ae,{pluginName:"revertOnSpill"}),le.prototype={onSpill:function(t){var e=t.dragEl,o=t.putSortable||this.sortable;o.captureAnimationState(),e.parentNode&&e.parentNode.removeChild(e),o.animateAll()},drop:re},u(le,{pluginName:"removeOnSpill"}),Bt.mount(new function(){function t(){for(var t in this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0},this)"_"===t.charAt(0)&&"function"==typeof this[t]&&(this[t]=this[t].bind(this))}return t.prototype={dragStarted:function(t){var e=t.originalEvent;this.sortable.nativeDraggable?w(document,"dragover",this._handleAutoScroll):this.options.supportPointer?w(document,"pointermove",this._handleFallbackAutoScroll):e.touches?w(document,"touchmove",this._handleFallbackAutoScroll):w(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(t){var e=t.originalEvent;this.options.dragOverBubble||e.rootEl||this._handleAutoScroll(e)},drop:function(){this.sortable.nativeDraggable?_(document,"dragover",this._handleAutoScroll):(_(document,"pointermove",this._handleFallbackAutoScroll),_(document,"touchmove",this._handleFallbackAutoScroll),_(document,"mousemove",this._handleFallbackAutoScroll)),ne(),oe(),clearTimeout(x),x=void 0},nulling:function(){Kt=Vt=Gt=ee=Jt=Qt=Zt=null,te.length=0},_handleFallbackAutoScroll:function(t){this._handleAutoScroll(t,!0)},_handleAutoScroll:function(t,e){var o=this,n=(t.touches?t.touches[0]:t).clientX,i=(t.touches?t.touches[0]:t).clientY,r=document.elementFromPoint(n,i);if(Kt=t,e||this.options.forceAutoScrollFallback||f||p||v){ie(t,this.options,r,e);var a=q(r,!0);!ee||Jt&&n===Qt&&i===Zt||(Jt&&ne(),Jt=setInterval(function(){var r=q(document.elementFromPoint(n,i),!0);r!==a&&(a=r,oe()),ie(t,o.options,r,e)},10),Qt=n,Zt=i)}else{if(!this.options.bubbleScroll||q(r,!0)===M())return void oe();ie(t,this.options,q(r,!1),!1)}}},u(t,{pluginName:"scroll",initializeByDefault:!0})}),Bt.mount(le,ae);const se=Bt;var ce=function(t,e,o,n){var i,r=arguments.length,a=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(r<3?i(a):r>3?i(e,o,a):i(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};let de=class extends t{constructor(){super(...arguments),this.queueTracks=[],this.queuePosition=null,this.queueSize=0,this.isLoading=!0,this.error=null,this.isDragging=!1,this.dragStartPosition=null,this._sortableInstance=null,this._pendingOperations=new Set}connectedCallback(){super.connectedCallback(),this._subscribeEntities()}disconnectedCallback(){super.disconnectedCallback(),this._unsubEntities&&this._unsubEntities(),this._sortableInstance&&this._sortableInstance.destroy()}_subscribeEntities(){if(!this.hass||!this.config?.entity)return;this._unsubEntities=this.hass.connection.subscribeEntities(t=>{const e=t[this.config.entity];e&&this._updateEntityState(e)});const t=this.hass.states[this.config.entity];t&&this._updateEntityState(t)}_updateEntityState(t){this.queueTracks=t.attributes.queue_tracks||[],this.queuePosition=t.attributes.queue_position??null,this.queueSize=t.attributes.queue_size||0,this.isLoading=!1,"unavailable"===t.state?this.error="Entity unavailable":this.error=null,this.requestUpdate()}_retry(){this.error=null,this.isLoading=!0,this._unsubEntities&&this._unsubEntities(),this._subscribeEntities()}_formatMetadata(t,e){return t||e}render(){return this.config&&this.hass?this.isLoading?o`
        <ha-card>
          <div class="card-content loading">
            <div class="spinner"></div>
            <div>Loading queue...</div>
          </div>
        </ha-card>
      `:this.error?o`
        <ha-card>
          <div class="card-content error-state">
            <div class="error-message">${this.error}</div>
            <button class="retry-button" @click=${this._retry}>Retry</button>
          </div>
        </ha-card>
      `:0===this.queueSize?o`
        <ha-card>
          <div class="card-content">
            ${this.config.title?o`<div class="card-header">${this.config.title}</div>`:""}
            <div class="empty-state">Queue is empty</div>
          </div>
        </ha-card>
      `:o`
      <ha-card>
        <div class="card-content">
          ${this.config.title?o`<div class="card-header">${this.config.title}</div>`:""}
          <div class="queue-list" id="queue-list">
            ${this.queueTracks.map((t,e)=>this._renderTrack(t,e))}
          </div>
        </div>
      </ha-card>
    `:o`<div class="error">Card not configured</div>`}_renderTrack(t,e){const n=t.position===this.queuePosition,i=t.position,r=this._formatMetadata(t.title,"Unknown Title"),a=this._formatMetadata(t.artist,"Unknown Artist"),l=this._formatMetadata(t.album,"Unknown Album"),s=t.duration?this._formatDuration(t.duration):"";return o`
      <div 
        class="track-item ${n?"playing":""}" 
        data-position="${i}"
        @click=${t=>this._handleTrackClick(t,i)}
        @touchend=${t=>this._handleTrackClick(t,i)}
      >
        <div class="track-position">${i}</div>
        <div class="track-info">
          <div class="track-title">${r}</div>
          <div class="track-artist">${a}</div>
          ${"Unknown Album"!==l?o`<div class="track-album">${l}</div>`:""}
        </div>
        ${s?o`<div class="track-duration">${s}</div>`:""}
        ${n?o`<div class="playing-indicator">â–¶</div>`:""}
      </div>
    `}_formatDuration(t){return`${Math.floor(t/60)}:${(t%60).toString().padStart(2,"0")}`}firstUpdated(){this._initSortable()}updated(t){super.updated(t),t.has("queueTracks")&&this._initSortable()}_initSortable(){const t=this.shadowRoot?.getElementById("queue-list");t&&(this._sortableInstance&&(this._sortableInstance.destroy(),this._sortableInstance=null),this._sortableInstance=se.create(t,{animation:150,ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",forceFallback:!1,fallbackTolerance:10,onStart:t=>{this.isDragging=!0,this.dragStartPosition=parseInt(t.item.getAttribute("data-position")||"0")},onEnd:t=>{this.isDragging=!1;const e=this.dragStartPosition,o=t.newIndex??-1,n=o>=0?o+1:e;e&&n&&e!==n&&this._moveTrack(e,n),this.dragStartPosition=null}}))}_handleTrackClick(t,e){this.isDragging||(t.preventDefault(),t.stopPropagation(),this._playTrackAtPosition(e))}async _moveTrack(t,e){this._pendingOperations.size>0&&await Promise.allSettled(Array.from(this._pendingOperations));const o=(async()=>{try{await this.hass.callService("mopidy","move_track",{from_position:t,to_position:e},{entity_id:this.config.entity})}catch(t){const e=t?.message||t?.code||"Unknown error";e.includes("network")||e.includes("connection")?this.error="Network error: Unable to connect to Mopidy server. Please check your connection.":e.includes("timeout")?this.error="Request timed out. The Mopidy server may be slow to respond.":e.includes("invalid")||e.includes("range")?this.error="Invalid position: Track positions may have changed. Please refresh.":this.error=`Failed to move track: ${e}`}finally{setTimeout(()=>{this.isDragging=!1},300)}})();this._pendingOperations.add(o),await o,this._pendingOperations.delete(o)}async _playTrackAtPosition(t){const e=this.isLoading;this.isLoading=!0;const o=(async()=>{try{await this.hass.callService("mopidy","play_track_at_position",{position:t},{entity_id:this.config.entity})}catch(e){const o=e?.message||e?.code||"Unknown error";o.includes("network")||o.includes("connection")?this.error="Network error: Unable to connect to Mopidy server. Please check your connection.":o.includes("timeout")?this.error="Request timed out. The Mopidy server may be slow to respond.":o.includes("invalid")||o.includes("range")||o.includes("empty")?this.error=`Invalid position: Track may no longer exist at position ${t}. Please refresh.`:this.error=`Failed to play track: ${o}`}finally{setTimeout(()=>{this.isLoading=e},500)}})();this._pendingOperations.add(o),await o,this._pendingOperations.delete(o)}};de.styles=e`
    ha-card {
      padding: 16px;
    }

    .card-content {
      display: flex;
      flex-direction: column;
    }

    .card-header {
      font-size: 18px;
      font-weight: 500;
      margin-bottom: 16px;
      color: var(--primary-text-color, #000);
    }

    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 40px;
      gap: 16px;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid var(--divider-color, #e0e0e0);
      border-top-color: var(--primary-color, #03a9f4);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .error-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 40px;
      gap: 16px;
    }

    .error-message {
      color: var(--error-color, #f44336);
      text-align: center;
    }

    .retry-button {
      padding: 8px 16px;
      background-color: var(--primary-color, #03a9f4);
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .retry-button:hover {
      opacity: 0.8;
    }

    .empty-state {
      text-align: center;
      padding: 40px;
      color: var(--secondary-text-color, #666);
    }

    .queue-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      overflow-y: auto;
    }

    .track-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      border: 1px solid var(--divider-color, #e0e0e0);
      border-radius: 4px;
      background-color: var(--card-background-color, #fff);
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .track-item:hover {
      background-color: var(--secondary-background-color, #f5f5f5);
    }

    .track-item.playing {
      background-color: var(--primary-color, #03a9f4);
      color: white;
      border-color: var(--primary-color, #03a9f4);
    }

    .track-item.sortable-ghost {
      opacity: 0.4;
    }

    .track-item.sortable-chosen {
      cursor: grabbing;
    }

    .track-position {
      font-weight: 600;
      min-width: 30px;
      text-align: center;
      color: var(--secondary-text-color, #666);
    }

    .track-item.playing .track-position {
      color: white;
    }

    .track-info {
      flex: 1;
      min-width: 0;
    }

    .track-title {
      font-weight: 500;
      margin-bottom: 4px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .track-artist {
      font-size: 0.9em;
      color: var(--secondary-text-color, #666);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .track-item.playing .track-artist {
      color: rgba(255, 255, 255, 0.9);
    }

    .track-album {
      font-size: 0.85em;
      color: var(--secondary-text-color, #666);
      margin-top: 2px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .track-item.playing .track-album {
      color: rgba(255, 255, 255, 0.8);
    }

    .track-duration {
      font-size: 0.9em;
      color: var(--secondary-text-color, #666);
      min-width: 50px;
      text-align: right;
    }

    .track-item.playing .track-duration {
      color: white;
    }

    .playing-indicator {
      font-size: 1.2em;
      color: var(--primary-color, #03a9f4);
      min-width: 24px;
      text-align: center;
    }

    .track-item.playing .playing-indicator {
      color: white;
    }
  `,ce([i({attribute:!1})],de.prototype,"hass",void 0),ce([i({attribute:!1})],de.prototype,"config",void 0),ce([r()],de.prototype,"queueTracks",void 0),ce([r()],de.prototype,"queuePosition",void 0),ce([r()],de.prototype,"queueSize",void 0),ce([r()],de.prototype,"isLoading",void 0),ce([r()],de.prototype,"error",void 0),ce([r()],de.prototype,"isDragging",void 0),ce([r()],de.prototype,"dragStartPosition",void 0),de=ce([n("mopidy-queue-card")],de),"undefined"!=typeof window&&window.customCards&&window.customCards.push({type:"mopidy-queue-card",name:"Mopidy Queue Card",description:"Interactive queue management card for Mopidy with drag-and-drop and tap-to-play"});export{de as MopidyQueueCard};